<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Recherche de caractères ou de sous-chaînes</title>
<link rel="stylesheet" href="../_local/codemirror.css">
<script src="../_local/codemirror_pour_php.js"></script>

<link rel="stylesheet" href="../_core/def.css">
<script>
	if (top.FP) {
		document.addEventListener('DOMContentLoaded', top.FP.initPage, false);
	} else {
		location.replace('../index.html?x=' + encodeURI(location.href));
	}
</script>
</head>
<body>
	<div id="MENU-top"></div>
	<nav id="MENU-tuto"></nav>

	<div id="PAGE-tuto">
		<header></header>
		<ul id="MENU-page"></ul>

		<p>Différentes fonctions permettent de faire des recherches de
			caractères ou de chaînes à l'intérieur d'une chaîne.
		<p>Parmi toutes les fonctions de recherche, les plus employées
			sont :</p>
		<ul class="fp-ul-1em">
			<li><a
				href="https://www.php.net/manual/fr/function.strpos.php" target="_blank">strpos()</a>
				qui renvoie la position d'une sous-chaîne à l'intérieur d'une
				chaîne,
			<li><a
				href="https://www.php.net/manual/fr/function.strrpos.php" target="_blank">strrpos()</a>
				qui renvoie la dernière position d'un caractère à l'intérieur d'une
				chaîne,
			<li><a
				href="https://www.php.net/manual/fr/function.strstr.php" target="_blank">strstr()</a>
				qui renvoie une partie de chaîne à partir de la position d'une
				sous-chaîne
			<li><a
				href="https://www.php.net/manual/fr/function.stristr.php" target="_blank">stristr()</a>
				est identique à <span class="fp-code">strsstr</span>, mais ignore
				les différences majuscules/minuscules
			<li><a
				href="https://www.php.net/manual/fr/function.strrchr.php" target="_blank">strrchr()</a>
				qui renvoient une partie de chaîne à partir de la dernière position
				d'un caractère à l'intérieur d'une chaîne.
		</ul>

		<p class="fp-rouge fp-bottom0 fp-t-center">
			<strong>ATTENTION IMPORTANT</strong>
		</p>
		<p>
			Toutes les fonctions de recherche retournent <span class="fp-code">FALSE</span>
			si elles ne trouvent pas ce qu'elles cherchent. Afin d'éviter de
			confondre le 0 de <span class="fp-code">FALSE</span> et le 0 de la
			position du premier caractère d'une chaîne, il faut <b>toujours
				tester le résultat</b> de ces fonctions avec <b>l'opérateur
				d'identité <span class="fp-code">===</span>
			</b> et pas avec l'opérateur d'égalité <b><span class="fp-code">==</span></b>.
		</p>
		<p class="fp-bottom0">Soit le code suivant :</p>
		<pre data-code="PHP">$x = 'François';
$pos = strpos($x, 'F');</pre>

		<p>
			<span class="fp-code">$pos</span> sera égal à 0, car 'F' est à la
			position 0 dans la chaîne <span class="fp-code">$x</span>.
		</p>
		<p class="fp-bottom0">Le test avec l'opérateur d'égalité simple :


		
		<pre data-code="PHP">if ($pos == false) { ...</pre>
		<p class="fp-bottom0">
			ne permettra pas de faire la différence entre le nombre 0 et le
			booléen <span class="fp-code">FALSE</span>. Le script sera donc faux
			car il considérera que 'F' n'a pas été trouvé dans 'François'.<br>
			Pour éviter le transtypage automatique de l'opérateur d'égalité
			simple et bien récupèrer le booléen FALSE ou le nombre 0, il faut
			tester la valeur de retour de la fonction avec l'opérateur
			d'identitié :
		<pre data-code="PHP">if ($pos === false) { ...</pre>

		<form action="" method="post" class="TEST-form">
			<a class="TEST-lien"
				onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_01.html')"
				title="Afficher la bibliothéque de fonctions"></a>
			<div class="TEST-titre">
				<strong>Exemple</strong> : rechercher dans une chaîne
			</div>
			<textarea name="txtCode" class="TEST-textarea">
&lt;?php
require('bib_fonctions.php');

htmlDebut('Recherches');

$x = 'Le langage PHP';

echo '&lt;h4&gt;Chaîne de test&lt;/h4&gt;', $x;

echo '&lt;h4&gt;Position de "langage"&lt;/h4&gt;',
     strpos($x, 'langage');

echo '&lt;h4&gt;Position du premier"e"&lt;/h4&gt;',
     strpos($x, 'e');

echo '&lt;h4&gt;Position du dernier "e"&lt;/h4&gt;',
     strrpos($x, 'e');

echo '&lt;h4&gt;Renvoie une chaîne à partir de "langage"&lt;/h4&gt;',
     strstr $x, 'langage');

echo '&lt;h4&gt;Renvoie une chaîne à partir du premier "e"&lt;/h4&gt;',
     strstr($x, 'e');

echo '&lt;h4&gt;Renvoie une chaîne à partie du dernier "e"&lt;/h4&gt;',
     strrch ($x, 'e');

htmlFin();
?&gt;</textarea>
		</form>

		<p class="fp-inter2">
			PHP permet de rechercher la dernière position d'un caractère dans une
			chaîne, mais n'offre pas de fonction permettant de rechercher la
			dernière position d'une sous-chaîne dans une chaîne. Pour réaliser ce
			travail, nous pouvons utiliser la fonction <a
				href="https://www.php.net/manual/fr/function.strrev.php" target="_blank">strrev()</a>
			qui inverse l'ordre des caractères dans une chaîne.
		</p>

		<form action="" method="post" class="TEST-form">
			<a class="TEST-lien"
				onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_01.html')"
				title="Afficher la bibliothéque de fonctions"></a>
			<div class="TEST-titre">
				<strong>Exemple</strong> : recherche de la dernière sous-chaîne
			</div>
			<textarea name="txtCode" class="TEST-textarea">
&lt;?php
require('bib_fonctions.php');

htmlDebut('La dernière sous-chaîne');

$x = 'ce bonbon est bon et même délicieux';
echo strLastStr($x, 'bon');

//---------------------------------------------------------
function strLastStr($boteDeFoin, $aiguille) {
  if ($boteDeFoin == '' || $aiguille == '') {
    return false;
  }
  
  $pos = strpos(strrev($boteDeFoin), strrev($aiguille));
  if ($pos === false) {
    return false;
  }
  $pos = strlen($boteDeFoin) - $pos - strlen($aiguille);
  return $pos;
}

htmlFin();
?&gt;</textarea>
		</form>

		<a id="exo_isAdresseMail"></a>
		<h3 class="fp-exo">Exercice : tester une adresse e-mail</h3>
		<section>
			<p class="fp-bottom0">
				Ecrivez la fonction <span class="fp-code">exo_isAdresseMail</span> qui
				vérifie qu'une adresse email est composée de :
			<ul class="fp-ul-puce">
				<li>au moins un caractère alphabétique, suivi éventuellement
					d'autres caractères</li>
				<li>le caractère @</li>
				<li>au moins un caractère alphabétique, suivi éventuellement
					d'autres caractères</li>
				<li>le caractère .</li>
				<li>de deux à quatre caractères alphabétiques</li>
			</ul>
			<p class="fp-bottom0">
				La chaîne ne doit contenir aucun espace.<br>Il ne peut y avoir
				qu'un caractère @<br>Les caractères doivent avoir l'un des
				codes ASCII suivants :
			</p>
			<ul class="fp-ul-puce">
				<li>45 : -</li>
				<li>46 : .</li>
				<li>48 à 57 : 0 à 9</li>
				<li>64 à 90 : @, A à Z</li>
				<li>95 : _</li>
				<li>97 à 122 : a à z</li>
			</ul>
			<p>
				Exemples à tester :<br> piat@univ-fcomte.frfr<br>
				piat@lifc.univ-fcomte.fr<br> piatunifc-fcomte.fr<br>
				piat@univfcomte-fr
			</p>
			<p class="fp-solution">
				<a onClick="top.FP.Voir.showSolution('exo_isAdresseMail_solu', 1)">Une
					solution possible</a>
			<div id="exo_isAdresseMail_solu" class="BLOC-solution">
				<form action="" method="post" class="TEST-form">
					<a class="TEST-lien"
						onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_02.html')"
						title="Afficher la bibliothéque de fonctions"></a>
					<div class="TEST-titre">
						<strong>Exercice</strong> : tester une adresse e-mail
					</div>
					<textarea name="txtCode" class="TEST-textarea">
&lt;?php
require('bib_fonctions.php');

/**
 * Teste si une chaîne est une adresse e-mail
 *
 * @param string	$txt	chaîne à tester
 * @return boolean	true si adresse mail
*/
function exo_isAdresseMail($txt) {
  // des espaces ?
  if (strpos($txt,' ') !== false) {
    return false;
  }
  // un arobase et un seul
  if (substr_count($txt, '@') != 1) {
    return false;
  }
  //premier caractère alpha
  if (!is_alpha($txt{0})) {
    return false;
  }
  //un point ?
  $pos = strrpos($txt,'.');
  if ($pos === false) {
    return false;
  }
  // au moins 1 caractère alpha avant le .
  if (!is_alpha($txt{$pos - 1})) {
    return false;
  }
  // caractères après le .
  $fin = substr($txt,$pos + 1);
  $long = strlen($fin);
  if ($long &lt; 2 || $long &gt; 4) {
    return false;
  }
  for ($i = 0; $i &lt; $long; $i++) {
    if (!is_alpha($fin{$i})) {
      return false;
    }
  }
  // pas de caractères interdits ?
  for ($i = 0; $i &lt; $pos; $i++) {
    if (is_alpha($txt{$i})) {
      continue;
    }
    $c = ord($txt{$i});
    if ($c &gt; 44 && $c &lt; 47) {
      continue;  // - et .
    }
    if ($c &gt; 47 && $c &lt;58) {
      continue;  // 0 à 9
    }
    if ($c == 64 || $c == 95) {
      continue;  // @ et _
    }
    return false;
  }
  return true;
}

/**
 * Teste si un caractère est alphabétique
 *
 * @param string	$c	caractère à tester
 * @return boolean	true si alpha
*/
function is_alpha($c) {
  $c = ord($c);
  if ($c &gt; 64 && $c &lt; 91) {
    return true;
  }
  if ($c &gt; 96 && $c &lt; 123) {
    return true;
  }
  return false;    
}

//---------------------------------------------------------
htmlDebut('Tester une adresse e-mail');

tester('exo_isAdresseMail', 'piat@univ-fcomte.frfr', TRUE);

tester('exo_isAdresseMail', 'piat@univ-fcomte.fr', TRUE);

tester('exo_isAdresseMail', 'piatunifc-fcomte.fr', FALSE);

tester('exo_isAdresseMail', 'piat@univfcomte-fr', FALSE);

htmlFin();
?&gt;</textarea>
				</form>

				<p class='fp-bottom0'>
					Vous serez sans doute surpris à la lecture du code par
					l'utilisation de la fonction <span class='fp-code'>tester</span>.
					C'est une fonction qui se trouve dans la bibliothèque <span
						class='fp-code'>bib_fonctions.php</span> et qui permet comme son
					nom l'indique de tester si une fonction renvoie le résultat
					attendu.<br> Cette fonction accepte au minimum 3 paramètres :
				</p>
				<ul class='fp-ul-puce'>
					<li>le nom de la fonction à tester sous la forme d'une chaîne
						de caractères</li>
					<li>le ou les paramètres attendus par la fonction à tester</li>
					<li>la valeur de retour de la fonction à tester</li>
				</ul>
				<p>Si le résultat renvoyé par la fonction à tester est celui
					attendu, le nom de la fonction est affiché en vert. Si ça n'est pas
					le cas, le nom de la fonction est affiché en rouge.</p>
				<pre data-code='PHP'>
/**
 * Testeur de fonction
 *
 * @param string	arg[0]		nom de la fonction à tester
 * @param mixed		arg[1 à n-1] paramètres à passer à la fonction
 * @param mixed		arg[n]		résultat attendu
 */
function tester() {
	$args = func_get_args();
	if (count($args) &lt; 3) {
		echo '&lt;hr&gt;La fonction tester doit avoir ',
						'au moins 3 paramètres.';
		return;
	}

	$fonction = array_shift($args);
	$attendu = array_pop($args);
	$retour = call_user_func_array($fonction, $args);

	$iMax = count($args);

	echo '&lt;hr&gt;&lt;span style="color:', 
			($retour === $attendu) ? 'green' : 'red', '"&gt;',
			'&lt;b&gt;', $fonction, '&lt;/b&gt;&lt;/span&gt;',
			'&lt;br&gt;Paramètre', ($iMax &gt; 1) ? 's : ' : ' : ';

	for ($i = 0; $i &lt; $iMax; $i++) {
		echo '&lt;span style="background:#ebebeb;margin:0 5px;"&gt;';
		var_dump($args[$i]);
		echo '&lt;/span&gt;';
	}

	echo '&lt;br&gt;Attendu : ';
	var_dump($attendu);

	echo '&lt;br&gt;Retourné : ';
	var_dump($retour);
}</pre>
			</div>
		</section>

	</div>
	<footer></footer>
</body>
</html>