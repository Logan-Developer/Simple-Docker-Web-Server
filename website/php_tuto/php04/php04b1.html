<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Répétitions fixées</title>
<link rel="stylesheet" href="../_local/codemirror.css">
<script src="../_local/codemirror_pour_php.js"></script>

<link rel="stylesheet" href="../_core/def.css">
<script>
	if (top.FP) {
		document.addEventListener('DOMContentLoaded', top.FP.initPage, false);
	} else {
		location.replace('../index.html?x=' + encodeURI(location.href));
	}
</script>
</head>
<body>
	<div id="MENU-top"></div>
	<nav id="MENU-tuto"></nav>

	<div id="PAGE-tuto">
		<header></header>
		<ul id="MENU-page"></ul>

		<p>
			La véritable force des expressions régulières réside dans les
			possibilités qu'elles offrent pour <b>constituer des modèles de
				recherche très généraux</b>, dans lesquelles les chaînes recherchées
			n'ont pas besoin d'être définies précisément, mais peuvent plutôt
			être décrites comme des <b>suites de caractères</b> acceptables, dont
			les <b>répétitions</b> peuvent être laissées libres (un chiffre de 1
			à 9999 par exemple) ou au contraire fixées car connues et devant
			répondre à un masque bien particulier (une adresse email par
			exemple).<br> Des régles de répétition de caractères, ou de
			groupes de caractères, permettent ainsi d'écrire à partir de modèles
			simples des expressions régulières complexes. Les modèles ainsi
			définis étendent les capacités de recherche et de substitution à un
			grand nombre de cas et de chaînes.
		</p>

		<h3>Répétitions fixées de caractères</h3>
		<section>
			<p class="fp-puce">
				Les <b>accolades ouvrantes et fermantes</b> ({ et }) permettent de
				définir la répétition de caractères, de classes ou de modèles.
			</p>
			<p>
				Par exemple, l'expression régulière<span class="fp-code">
					/il{2}/</span> recherchera un i suivi de 2 l. Elle sera vraie pour
				"Djedaille", et fausse pour "il".
			</p>
			<p>
				Pour tester qu'un code postal français est correct, l'expression
				régulière peut être <span class="fp-code">/\d{5}/</span>, <br>
				équivalente à <span class="fp-code">/[[:digit:]]{5}/</span>, <br>
				équivalente à <span class="fp-code">/[0-9]{5}/</span>.
			</p>

			<p>
				Pour tester qu'une date qu'une date est formatée suivant le modèle
				JJ/MM/AAAA, l'expression régulière sera <span class="fp-code">/\d{2}\/\d{2}\/\d{4}/</span>
				(je vous laisse trouver les équivalences).<br> Notez le
				backslash (\) de protection devant les slash (/) séparant le jour, le
				mois et l'année.
			</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions fixées de caractères
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions fixées');

$txt = "il y a bien longtemps, dans une très lointaine galaxie (36éme lune à gauche après le Djedaille's Bar)...";

htmlInfo('Recherche "ill"');
testerExp('/il{2}/', $txt);

htmlInfo('Recherche les voyelles doublées');
testerExp('/[aeiou]{2}/', $txt);

htmlInfo('Recherche 5 chiffres consécutifs');
$txt = '1234 12345 12b45 12,345 12.345 ';
testerExp('/\d{5}/', $txt);

htmlFin();
?&gt;</textarea>
			</form>

		</section>

		<a id="cartebancaire"></a>
		<h3 class="fp-exo">Exercice : vérifier le format d'un numéro de
			carte bancaire</h3>
		<section>
			<p>Les numéros de cartes bancaires sont constitués par un préfixe
				indiquant le type de carte, suivi d'un nombre variable de chiffres.</p>
			<table>
				<tr>
					<td width="98">
						<p class="center">Type de carte</p>
					</td>
					<td width="118">
						<p class="center">Préfixe</p>
					</td>
					<td width="89">
						<p class="center">
							Nombre total<br> de chiffres
						</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">MasterCard</p>
					</td>
					<td width="118">
						<p class="center">de 51 à 55</p>
					</td>
					<td width="89">
						<p class="center">16</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">Visa</p>
					</td>
					<td width="118">
						<p class="center">4</p>
					</td>
					<td width="89">
						<p class="center">13 ou 16</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">AMEX</p>
					</td>
					<td width="118">
						<p class="center">34 ou 37</p>
					</td>
					<td width="89">
						<p class="center">15</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">DinnersClub</p>
					</td>
					<td width="118">
						<p class="center">
							de 300 à 305, <br> ou 36 ou 38
						</p>
					</td>
					<td width="89">
						<p class="center">14</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">Discover</p>
					</td>
					<td width="118">
						<p class="center">6011</p>
					</td>
					<td width="89">
						<p class="center">16</p>
					</td>
				</tr>
				<tr>
					<td width="98">
						<p class="center">enRoute</p>
					</td>
					<td width="118">
						<p class="center">2014 ou 2149</p>
					</td>
					<td width="89">
						<p class="center">15</p>
					</td>
				</tr>
				<tr>
					<td rowspan="2">
						<p class="center">JCB</p>
					</td>
					<td width="118">
						<p class="center">3</p>
					</td>
					<td width="89">
						<p class="center">16</p>
					</td>
				</tr>
				<tr>
					<td width="118">
						<p class="center">2131 ou 1800</p>
					</td>
					<td width="89">
						<p class="center">15</p>
					</td>
				</tr>
			</table>
			<p>Votre mission si vous l'acceptez, n'est pas de créer des faux
				numéros de cartes bancaires, mais d'écrire une expression régulière
				par type de carte qui permette de vérifier que le numéro donné est
				correcte par rapport au format attendu.
			<p>
				<b>Pour vous aider ...</b>
			<p>
				Si on imagine que le numéro de carte a été saisi par l'utilisateur
				au travers d'une zone de formulaire, il peut être précédé et/ou
				suivi d'espaces ou d'autres caractères. Il nous faut donc d'abord
				être sûr que le numéro que nous testons n'est pas "pollué" par
				d'autres caractères. <br> Nous devons donc constuire une régle
				qui définit que la valeur à tester commence obligatoirement par
				certains caractères, et se termine obligatoirement par certains
				autres caractères.
			<p class="FP-p-puce">
				On spécifie qu'une chaîne doit <b>commencer par un caractère
					précis avec le métacaractère ^</b>. <br> Par exemple <span
					class="fp-code">/^a/</span> indique que la chaîne à tester doit
				commencer obligatoirement par a.
			<p class="fp-puce">
				On spécifie qu'une chaîne doit <b>finir par un caractère précis
					avec le métacaractère <span class="fp-code">$</span>
				</b>. <br> Par exemple <span class="fp-code">/z$/</span> indique
				que la chaîne à tester doit se terminer obligatoirement par z.
			<p>
				Ainsi l'expression régulière <span class="fp-code">/^\d{10}$/</span>
				indique que la chaîne à tester doit se composer d'un nombre de dix
				chiffres, ni plus, ni moins, et à l'exclusion de tout caractère non
				numérique.
			<p>
				L'expression régulière pour tester le format d'une carte de type
				Discover sera donc : <span class="fp-code">/^6011\d{12}$/</span> <br>
				<span class="fp-code">^6011</span> indique que le numéro doit
				commencer par 6011<br> <span class="fp-code">\d{12}$</span>
				indique que le numéro doit se terminer par 12 chiffres.
			<p class="fp-solution">
				<a onClick="top.FP.Voir.showSolution('cartebancaire_solu', 1)">Une
					solution possible</a>
			</p>
			<div id="cartebancaire_solu" class="BLOC-solution">
				<form action="" method="post" class="TEST-form">
					<a class="TEST-lien"
						onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
						title="Afficher la bibliothéque de fonctions"></a> <a
						class="TEST-lien-exp" title="Afficher un résumé des expressions"
						onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
					<div class="TEST-titre">
						<strong>Exercice</strong> : tester un numéro de carte bancaire
					</div>
					<textarea name="txtCode" class="TEST-textarea">
&lt;?php
require('bib_fonctions.php');

htmlDebut('Tester un numéro de carte bancaire');

//------------------------------------------------
htmlInfo('MASTERCARD');
echo 'Préfixe de 51 à 55, suivi de 14 chiffres';

$expression = '/^5[1-5]\d{14}$/';

$numeroCarte = '5212345678901234';
testerExp($expression, $numeroCarte);

$numeroCarte = '5612345678901234';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('VISA');
echo 'Préfixe 4, suivi de 12 ou 15 chiffres';

$expression = '/^4\d{12}$|^4\d{15}$/';

$numeroCarte = '4123456789012345';
testerExp($expression, $numeroCarte);

$numeroCarte = '412345678901';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('AMEX');
echo 'Préfixe de 34 ou 37, suivi de 13 chiffres';

$expression = '/^3[47]\d{13}$/';

$numeroCarte = '371234567890123';
testerExp($expression, $numeroCarte);

$numeroCarte = '361234567890123';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('DINNERS');
echo 'Préfixe de 300 à 305, suivi de 11 chiffres&lt;br&gt;',
	'ou préfixe 36 ou 36, suivi de 12 chiffres';

$expression = '/^30[0-5]\d{11}$|^3[68]\d{12}$/';

$numeroCarte = '30212345678901';
testerExp($expression, $numeroCarte);

$numeroCarte = '30712345678901';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('DISCOVER');
echo 'Préfixe 6011, suivi de 12 chiffres';

$expression = '/^6011\d{12}$/';

$numeroCarte = '6011123456789012';
testerExp($expression, $numeroCarte);

$numeroCarte = '601112345678901';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('ENROUTE');
echo 'Préfixe 2014 ou 2149, suivi de 11 chiffres';
$expression = '/^2014\d{11}$|^2149\d{11}$/';

$numeroCarte = '201412345678901';
testerExp($expression, $numeroCarte);

$numeroCarte = '205012345678901';
testerExp($expression, $numeroCarte);

//------------------------------------------------
htmlInfo('JCB');
echo 'Préfixe 3, suivi de 15 chiffres&lt;br&gt;',
	'ou préfixe 2131 ou 1800, suivi de 11 chiffres';

$expression = '/^3\d{15}$|^2131\d{11}$|^1800\d{11}$/';

$numeroCarte = '180012345678901';
testerExp($expression, $numeroCarte);

$numeroCarte = '2123456789012345';
testerExp($expression, $numeroCarte);

htmlFin();
?&gt;								
					</textarea>
				</form>
			</div>
		</section>

	</div>
	<footer></footer>
</body>
</html>