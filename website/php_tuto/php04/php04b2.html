<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Répétitions délimitées</title>
<link rel="stylesheet" href="../_local/codemirror.css">
<script src="../_local/codemirror_pour_php.js"></script>

<link rel="stylesheet" href="../_core/def.css">
<script>
	if (top.FP) {
		document.addEventListener('DOMContentLoaded', top.FP.initPage, false);
	} else {
		location.replace('../index.html?x=' + encodeURI(location.href));
	}
</script>
</head>
<body>
	<div id="MENU-top"></div>
	<nav id="MENU-tuto"></nav>

	<div id="PAGE-tuto">
		<header></header>
		<ul id="MENU-page"></ul>

		<section>
			<p>Nous venons de voir comment utiliser les accolades { et } pour
				définir une répetition fixe de caractères, de classes ou de modèles.
			</p>
			<p class="fp-puce">
				Les accolades permettent également de <b>définir des limites
					mini et maxi</b> pour la répétition.
			</p>

			<table>
				<tr>
					<td>
						<p align="center">{n}</p>
					</td>
					<td>
						<p>
							Le caractère précédent est répété exactement n fois.<br> <span
								class="fp-code">/il{2}/</span> sera trouvé dans "Djedaille",
							mais pas dans "il".
						</p>
					</td>
				</tr>
				<tr>
					<td>
						<p align="center">{n,}</p>
					</td>
					<td>
						<p>
							Le caractère précédent est répété n ou plus de fois. <br> <span
								class="fp-code">/\d{3,}/</span> vérifie qu'un nombre est composé
							d'au minimum trois chiffres, sans limite maximum de la
							répétition. 123 sera correct, comme 000, et comme 123456789.
						</p>
					</td>
				</tr>
				<tr>
					<td>
						<p align="center">{n,m}</p>
					</td>
					<td>
						<p>
							Le caractère précédent est répété au moins n fois, et au plus m
							fois.<br> <span class="fp-code">/[[:alpha:]]{4,6}/</span>
							permettra de sélectionner des chaînes de 4 à 6 caractères
							alphabétiques.
						</p>
					</td>
				</tr>
			</table>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

$txt = "Il y a bien longtemps, dans une très lointaine galaxie (36éme lune à gauche après le Djedaille's Bar)...";

htmlInfo('Recherche des consommes qui se suivent');
testerExp('/[bcdfghjklmnpqrstvwxyz]{2,}/', $txt);

htmlInfo('Recherche des mots de 5 caractères ou plus');
testerExp('/\w{5,}/', $txt);

htmlFin();
?&gt;</textarea>
			</form>

			<p>Pour tester les répétitions avec une limite mini et une limite
				maxi, nous prendrons comme exemple la vérification de nombres
				entiers et de nombres décimaux, saisis par exemple dans une zone de
				formulaire, et que nous devons vérifier avant traitement.</p>

			<p>
				<b>Premier exemple</b> : nous voulons vérifier qu'un nombre (une
				quantité par exemple) est un entier compris entre 0 et 9999. <br>
				La valeur à tester doit commencer obligatoirement par un chiffre :<br>
				<span class="fp-code">/<span class="fp-rouge">^\d</span>/
				</span><br> Il peut y avoir de 1 à 4 chiffres :<br> <span
					class="fp-code">/^\d<span class="fp-rouge">{1,4}</span>/
				</span><br> Et c'est tout ce que nous acceptons :<br> <span
					class="fp-code">/^\d{1,4}<span class="fp-rouge">$</span>/
				</span>
			</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

htmlInfo('Un nombre entier entre 0 et 9999');

$exp = '/^\d{1,4}$/';

testerExp($exp, 123);
testerExp($exp, 12345);
testerExp($exp, 0);
testerExp($exp, 12.34);
testerExp($exp, -1234);

htmlFin();
?&gt;</textarea>
			</form>

			<p>
				<b>Deuxième exemple</b> : nous voulons vérifier qu'un nombre est un
				entier compris entre 1 et 9999. <br> La valeur à tester doit
				commencer obligatoirement par un chiffre de 1 à 9 :<br> <span
					class="fp-code">/<span class="fp-rouge">^[1-9]</span>/
				</span><br> Il peut y avoir ensuite aucun ou au plus 3 autres chiffres
				:<br> <span class="fp-code">/^[1-9]<span
					class="fp-rouge">\d{0,3}</span>/
				</span><br> Et c'est tout ce que nous acceptons :<br> <span
					class="fp-code">/^[1-9]\d{0,3}<span class="fp-rouge">$</span>/
				</span>
			</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

htmlInfo('Un nombre entier entre 1 et 9999');

$exp = '/^[1-9]\d{0,3}$/';

testerExp($exp, 123);
testerExp($exp, 12345);
testerExp($exp, 0);
testerExp($exp, 12.34);
testerExp($exp, -1234);

htmlFin();
?&gt;</textarea>
			</form>

			<p>
				<b>Troisième exemple</b> : nous voulons vérifier qu'un nombre est un
				entier compris entre -9999 et 9999.
			</p>
			<p>
				Nous commencerons par le cas où les 0 sont permis. La valeur
				à tester peut commencer par le signe -, soit une répetition de 0 ou
				1 fois :<br> <span class="fp-code">/<span
					class="fp-rouge">^-{0,1}</span>/
				</span><br> Il peut y avoir ensuite de 1 à 4 chiffres :<br> <span
					class="fp-code">/^-{0,1}<span class="fp-rouge">\d{1,4}</span>/
				</span><br> Et c'est tout ce que nous acceptons :<br> <span
					class="fp-code">/^-{0,1}\d{1,4}<span class="fp-rouge">$</span>/
				</span>
			</p>

			<p>
				Dans le cas où les 0 ne sont pas permis, la valeur à tester
				peut commencer soit par le signe -, soit par un chiffre de 1 à 9 :<br>
				<span class="fp-code">/<span class="fp-rouge">^[\-1-9]</span>/
				</span><br> Vous noterez qu'ici nous devons échapper le signe - par un
				backslash (\) car entre des crochets ([ et ]), le signe - est un
				métacaractère qui permet de définir des listes.<br> Il peut y
				avoir ensuite aucun ou au plus 3 autres chiffres :<br> <span
					class="fp-code">/^[\-1-9]<span class="fp-rouge">\d{0,3}</span>/
				</span><br> Et c'est tout ce que nous acceptons :<br> <span
					class="fp-code">/^[\-1-9]\d{0,3}<span class="fp-rouge">$</span>/
				</span>
			</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

htmlInfo('Un nombre entier entre -9999 et 9999');

$exp = '/^-{0,1}\d{1,4}$/';

testerExp($exp, 123);
testerExp($exp, 12345);
testerExp($exp, 0);
testerExp($exp, 12.34);
testerExp($exp, -1234);

htmlInfo('Un nombre entier entre -9999 et 9999, 0 exclu');

$exp = '/^[\-1-9]\d{0,3}$/';

testerExp($exp, 123);
testerExp($exp, 12345);
testerExp($exp, 0);
testerExp($exp, 12.34);
testerExp($exp, -1234);

htmlFin();
?&gt;</textarea>
			</form>

			<p>
				Pour le <b>quatrième exemple</b> nous allons travailler avec des
				nombres décimaux : nous voulons vérifier qu'un nombre rentre bien
				dans le format -####.## et ici les 0 sont admis.
			</p>
			<p>
				La valeur à tester peut commencer par le signe -, soit une
				répetition de 0 ou 1 fois :<br> <span class="fp-code">/<span
					class="fp-rouge">^-{0,1}</span>/
				</span><br> Il peut y avoir ensuite de 1 à 4 chiffres :<br> <span
					class="fp-code">/^-{0,1}<span class="fp-rouge">\d{1,4}</span>/
				</span><br> On trouve après un point qui sert de délimiteur décimal.
				Le caractère point (.) doit être échappé avec un backslash (\) :<br>
				<span class="fp-code">/^-{0,1}\d{1,4}<span class="fp-rouge">\.</span>/
				</span><br> On aura finalement la partie décimale de 2 chiffres
				maximum :<br> <span class="fp-code">/^-{0,1}\d{1,4}\.<span
					class="fp-rouge">\d{0,2}$</span>/
				</span>
			</p>
			<p>
				On pourrait s'arrêter là, mais il y a quelque chose qui va ennuyer
				l'utilisateur : si il veut saisir 123 et pas de décimal, il sera
				obligé de saisir 123point (123.)<br> Pour parfaire l'expression
				régulière, nous pouvons utiliser l'opérateur <span class="fp-code">ou</span>.
				Nous avons déjà construit l'expression régulière pour valider un
				entier signé de 4 chiffres :<br> <span class="fp-code">/^-{0,1}\d{1,4}$/</span>
				<br> Il nous suffit de lier les 2 expressions :<br> <span
					class="fp-code">/^-{0,1}\d{1,4}$|^-{0,1}\d{1,4}\.\d{0,2}$/</span>
			</p>
			<p class="fp-remarque">Nous verrons dans quelques instants
				comment simplifier cette expression avec l'utilisation de
				parenthèses.</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true"
					rows="28" cols="55">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

htmlInfo('Un nombre à 2 décimales entre -9999.99 et 9999.99');

$exp = '/^-{0,1}\d{1,4}$|^-{0,1}\d{1,4}\.\d{0,2}$/';

testerExp($exp, 123.45);
testerExp($exp, 1234.5);
testerExp($exp, -12);
testerExp($exp, -0.12);
testerExp($exp, 12.345);

htmlFin();
?&gt;</textarea>
			</form>

			<p>
				<b>IMPORTANT : </b> chaque fois que des données viennent de
				l'extérieur, <b>une validation</b> doit être faite <b>avant un
					traitement</b> sur le serveur. L'utilisateur a pu oublier une saisie
				obligatoire ou faire une faute ou introduire une incohérence. En
				plus de ces erreurs normales car indissociables d'une activité
				humaine, il faut aussi prendre en compte celles introduites avec une
				volonté délibérée de nuire.<br> Le <b>niveau minimal</b> de la
				validation concerne <b>le format</b> et le "masque de saisie" : un
				nom devrait être composé uniquement de caractère alphabétique, d'un
				tiret et d'un apostrophe éventuel, un nombre devrait être composé
				uniquement de chiffres, avec un tiret et un point éventuel, etc. <br>
				HTML fourni divers types de <b>zones de saisie</b>, regroupées dans
				des <b>formulaires</b>, pour que l'utilisateur puisse envoyer des
				données à traiter au serveur. Mais <b>HTML ne fournit aucun
					mécanisme de vérification</b> des saisies faites par l'intermédiaire
				d'un formulaire. <br> De la même façon, les informations qui <b>transistent
					à la suite d'une URL</b> peuvent être facilement <b>modifiées
					manuellement</b> dans la barre d'adresse du navigateur et envoyées au
				serveur.<br> Pour les formulaires, une première validation peut
				être faite avec JavaScript du côté client, et avant envoi des
				données saisies au serveur pour traitement. <br> Dans tous les
				cas, une éventuelle première validation avec JavaScript doit
				absolument être doublée par une seconde <b>validation sur le
					serveur lui même</b>, de façon à garantir un maximum de sécurité dans
				le traitement de ces informations et à éviter les tentatives de
				corruption de données qui peuvent déstabiliser gravement le système
				du serveur, la base de données ou votre application. <br> Dans
				le cadre de ces vérifications et aussi bien du côte JavaScript que
				du côté PHP, les expressions régulières constituent une des
				meilleures armes qui soit.
			</p>

		</section>

		<h3>Répétitions délimitées : syntaxe réduite</h3>
		<section>
			<p class="fp-puce">
				Certaines limites sont très souvent utilisées, et elles peuvent être
				écrites avec une <b>syntaxe réduite</b>.
			<table>
				<tr>
					<td valign="TOP">
						<p align="center">*</p>
					</td>
					<td>
						<p>Le caractère précédant * est répété 0 ou plusieurs fois.
							C'est l'équivalent de {0,}.</p>
					</td>
				</tr>
				<tr>
					<td valign="TOP">
						<p align="center">+</p>
					</td>
					<td>
						<p>Le caractère précédant + est répété une ou plusieurs fois.
							C'est l'équivalent de {1,}.</p>
					</td>
				</tr>
				<tr>
					<td valign="TOP">
						<p align="center">?</p>
					</td>
					<td>
						<p>
							Le caractère précédant ? est répété 0 ou une fois. C'est
							l'équivalent de {0,1}.<br> Remarque : pour qu'il soit
							interprété comme métacaractère de répétition, le ? ne doit pas
							suivre une parenthèse ouvrante, un astérisque, un plus ou un
							point d'exclamation.
						</p>
					</td>
				</tr>
			</table>
			<p>
				Nous pouvons reprendre l'exemple précédent sur le nombre au format
				-####.##. L'expression régulière était :<br> <span
					class="fp-code">/^-{0,1}\d{1,4}\.\d{0,2}$/</span><br> Le test
				du caractère -<br> <span class="fp-code">-{0,1}</span> <br>
				peut être écrit :<br> <span class="fp-code">-? </span>
			</p>
			<p>
				Ce qui donne l'expression :<br> <span class="fp-code">/^-?\d{1,4}\.\d{0,2}$/</span>
			</p>

			<form action="" method="post" class="TEST-form">
				<a class="TEST-lien"
					onclick="top.FP.Voir.showPLUS('exemple/bib_fonctions_14.html')"
					title="Afficher la bibliothéque de fonctions"></a> <a
					class="TEST-lien-exp" title="Afficher un résumé des expressions"
					onclick="top.FP.Voir.showPLUS('php04/resume.html')"></a>
				<div class="TEST-titre">
					<strong>Exemple</strong> : répétitions délimitées, syntaxe réduite
				</div>
				<textarea name="txtCode" class="TEST-textarea" data-wrap="true">&lt;?php
require('bib_fonctions.php');

htmlDebut('Répétitions délimitées');

htmlInfo('Un nombre à 2 décimales entre -9999.99 et 9999.99');

$exp = '/^-?\d{1,4}$|^-?\d{1,4}\.\d{0,2}$/';

testerExp($exp, 123.45);
testerExp($exp, 1234.5);
testerExp($exp, -12);
testerExp($exp, -0.12);
testerExp($exp, 12.345);

htmlFin();
?&gt;</textarea>
			</form>

		</section>

	</div>
	<footer></footer>
</body>
</html>